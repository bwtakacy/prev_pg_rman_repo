\! bash sql/backup.sh
###### BACKUP COMMAND TEST-0001 ######
###### full backup mode ######
0
1
7
###### BACKUP COMMAND TEST-0002 ######
###### incremental backup mode ######
0
2
14
###### BACKUP COMMAND TEST-0003 ######
###### archive backup mode ######
0
3
25
###### BACKUP COMMAND TEST-0004 ######
###### full backup with server log ######
0
1
3
###### BACKUP COMMAND TEST-0005 ######
###### full backup with compression ######
0
1
1
3
###### BACKUP COMMAND TEST-0006 ######
###### full backup with smooth checkpoint ######
0
1
3
###### BACKUP COMMAND TEST-0008 ######
###### full backup with keep-arclog-files and keep-arclog-days ######
The number of existing archive log files already backuped is greater than 2.
OK. Let's try to test --keep-arclog-files=2.
0
1
3
Number of remaining archivelog files: 2
###### BACKUP COMMAND TEST-0009 ######
###### full backup with keep-srvlog-files and keep-srvlog-days ######
The number of existing server log files already backuped is greater than 1.
OK. Let's try to test --keep-srvlog-files=1.
0
1
3
Number of remaining serverlog files: 1
###### BACKUP COMMAND TEST-0010 ######
###### switch backup mode from incremental to full ######
incremental backup without validated full backup
INFO: copying database files
ERROR: cannot take an incremental backup
DETAIL: There is no validated full backup with current timeline.
HINT: Please take a full backup and validate it before doing an incremental backup. Or use with --full-backup-on-error command line option.
10
incremental backup in the same situation but with --full-backup-on-error option
INFO: copying database files
NOTICE: There is no validated full backup with current timeline. Switching to full backup mode.
INFO: copying archived WAL files
INFO: copying server log files
INFO: backup complete. Please execute 'pg_rman validate' to verify the files are correctly copied.
0
1
1
###### BACKUP COMMAND TEST-0011 ######
###### switch backup mode from archive to full ######
archive backup without validated full backup
ERROR: cannot take an incremental backup
DETAIL: There is no validated full backup with current timeline.
HINT: Please take a full backup and validate it before doing an archive backup. Or use with --full-backup-on-error command line option.
10
archive backup in the same situation but with --full-backup-on-error option
NOTICE: There is no validated full backup with current timeline. Switching to full backup mode.
INFO: copying database files
INFO: copying archived WAL files
INFO: copying server log files
INFO: backup complete. Please execute 'pg_rman validate' to verify the files are correctly copied.
0
1
1
